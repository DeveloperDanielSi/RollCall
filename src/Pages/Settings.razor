@page "/settings"
@attribute [Authorize]
@inject IJSRuntime JSRuntime
@inject NavigationManager Navigation

<PageTitle>Settings</PageTitle>

<!-- User Profile Section -->
<h3>User Profile</h3>
<div>
    <p>Name: @userName</p>
    <p>Email: @userEmail</p>
</div>

<!-- Theme Settings Section -->
<h3>Theme Settings</h3>
<div>
    <label>
        <input type="radio" name="theme" value="light" @onclick="SetLightTheme" /> Light Mode
    </label>
    <label>
        <input type="radio" name="theme" value="dark" @onclick="SetDarkTheme" /> Dark Mode
    </label>
</div>

<!-- Logout Button -->
<button class="btn btn-primary" @onclick="Logout">Logout</button>

@code {
    // Fields to store user data
    private string userName = string.Empty;
    private string userEmail = string.Empty;

    // On component initialization, fetch user data from JavaScript
    protected override async Task OnInitializedAsync()
    {
        var userData = await JSRuntime.InvokeAsync<UserData>("getUserData");
        if (userData != null)
        {
            userName = userData.DisplayName;
            userEmail = userData.Email;
            StateHasChanged(); // Notify the component to re-render
        }
    }

    // Method to update user data fields
    public async Task UpdateUserData(UserData userData)
    {
        userName = userData.DisplayName;
        userEmail = userData.Email;
        await InvokeAsync(StateHasChanged); // Notify the component to re-render
    }

    // Method to log out the user
    private async Task Logout()
    {
        await JSRuntime.InvokeVoidAsync("logout"); // Call JavaScript function to log out
        Navigation.NavigateTo("/"); // Navigate to the home page
    }

    // Method to set the light theme
    private void SetLightTheme()
    {
        SetTheme("light");
    }

    // Method to set the dark theme
    private void SetDarkTheme()
    {
        SetTheme("dark");
    }

    // Helper method to set the theme
    private void SetTheme(string theme)
    {
        // Logic to set the theme
        // You might want to store the theme setting in local storage or a database
        Console.WriteLine($"Theme set to: {theme}");
    }

    // Class to represent user data
    public class UserData
    {
        public string DisplayName { get; set; } = string.Empty;
        public string Email { get; set; } = string.Empty;
    }
}
